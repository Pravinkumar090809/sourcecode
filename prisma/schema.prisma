// ═══════════════════════════════════════════════════════
//  CODEVAULT — Prisma Schema (Supabase SAFE)
//  IMPORTANT:
//  - Supabase Auth tables (auth.*) are NOT touched
//  - All app tables live in public schema
//  - Uses prisma db push (NO migrate)
//  - directUrl = direct Supabase connection (port 5432)
//    used by Prisma for db push / migrations
//  - url = pooler connection (port 6543) used at runtime
// ═══════════════════════════════════════════════════════

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ─────────────────────────────────────────────
// USERS (CUSTOM APP USERS — NOT supabase auth.users)
// Store Supabase auth user id as string only (NO FK)
// ─────────────────────────────────────────────
model User {
  id                String   @id @default(uuid())
  email             String   @unique
  password          String
  full_name         String?
  phone             String?  @default("")
  avatar_url        String?  @default("")
  bio               String?  @default("")
  role              String   @default("customer")

  // if you use Supabase Auth, store auth.users.id here (string only)
  supabase_user_id  String?

  created_at        DateTime @default(now())
  updated_at        DateTime @default(now()) @updatedAt

  orders            Order[]
  reviews           Review[]

  @@map("users")
}

// ─────────────────────────────────────────────
// PRODUCTS
// ─────────────────────────────────────────────
model Product {
  id                Int      @id @default(autoincrement())
  slug              String   @unique
  name              String
  description       String?  @default("")
  short_description String?  @default("")
  price             Int      @default(0)
  original_price    Int      @default(0)
  category_id       Int?
  category          String?  @default("")
  tags              String[] @default([])
  image_url         String?  @default("")
  rating            Float?   @default(0)
  reviews_count     Int?     @default(0)
  downloads         Int?     @default(0)
  featured          Boolean  @default(false)
  tech_stack        String[] @default([])
  features          String[] @default([])
  demo_url          String?  @default("")
  is_active         Boolean  @default(true)

  created_at        DateTime @default(now())
  updated_at        DateTime @default(now()) @updatedAt

  orders            Order[]
  reviews           Review[]

  @@map("products")
}

// ─────────────────────────────────────────────
// ORDERS
// ─────────────────────────────────────────────
model Order {
  id             String   @id @default(uuid())
  order_number   String   @unique

  user_id        String?
  product_id     Int?

  product_name   String
  amount         Int      @default(0)
  status         String   @default("pending")
  payment_method String?  @default("card")
  payment_id     String?  @default("")

  created_at     DateTime @default(now())
  updated_at     DateTime @default(now()) @updatedAt

  user           User?    @relation(fields: [user_id], references: [id], onDelete: SetNull)
  product        Product? @relation(fields: [product_id], references: [id], onDelete: SetNull)

  @@map("orders")
}

// ─────────────────────────────────────────────
// CONTACT MESSAGES
// ─────────────────────────────────────────────
model ContactMessage {
  id         Int      @id @default(autoincrement())
  name       String
  email      String
  subject    String?  @default("")
  message    String
  is_read    Boolean  @default(false)
  created_at DateTime @default(now())

  @@map("contact_messages")
}

// ─────────────────────────────────────────────
// REVIEWS
// ─────────────────────────────────────────────
model Review {
  id         Int      @id @default(autoincrement())
  user_id    String?
  product_id Int?
  rating     Int
  comment    String?  @default("")
  created_at DateTime @default(now())

  user       User?    @relation(fields: [user_id], references: [id], onDelete: SetNull)
  product    Product? @relation(fields: [product_id], references: [id], onDelete: SetNull)

  @@map("reviews")
}